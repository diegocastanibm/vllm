1-Run:
vllm serve meta-llama/Llama-3.2-1B --swap-space 16 --disable-log-requests
or
VLLM_USE_V1=1 VLLM_LOGGING_LEVEL=DEBUG VLLM_LOG_BATCHSIZE_INTERVAL=1 vllm serve meta-llama/Llama-3.2-1B
where the VLLM_LOG_BATCHSIZE_INTERVAL provides stats of each batchsize

2-Run:
python3 vllm/benchmarks/benchmark_serving.py --backend vllm --model meta-llama/Llama-3.2-1B --endpoint /v1/completions --dataset-name sharegpt --dataset-path ShareGPT_V3_unfiltered_cleaned_split.json --num-prompts 10

If you need to download the dataset (shareGPT) do:
wget <https://huggingface.co/datasets/anon8231489123/ShareGPT_Vicuna_unfiltered/resolve/main/ShareGPT_V3_unfiltered_cleaned_split.json>

NOte:
If you have an error that pandas or dataset packages are missed, we need to run:
pip install vllm[bench]

RESULTS:

We just need to take the last line for each number of prompts because the counts are just updated. So, for example, for the promt=10 we would use just:
INFO 07-29 11:13:38 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 528, 3.76), (1, 119, 3.4), (4, 87, 3.69), (8, 31, 3.71), (16, 2, 5.14)]

with number of promts: 10
INFO 07-29 11:13:35 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(1, 119, 3.4), (4, 40, 3.72), (8, 31, 3.71), (16, 2, 5.14)]
INFO 07-29 11:13:36 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 146, 3.68), (1, 119, 3.4), (4, 87, 3.69), (8, 31, 3.71), (16, 2, 5.14)]
INFO 07-29 11:13:37 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 338, 3.75), (1, 119, 3.4), (4, 87, 3.69), (8, 31, 3.71), (16, 2, 5.14)]
INFO 07-29 11:13:38 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 528, 3.76), (1, 119, 3.4), (4, 87, 3.69), (8, 31, 3.71), (16, 2, 5.14)]

with number of promts: 100
INFO 07-29 11:15:07 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 622, 3.76), (1, 267, 3.4), (4, 87, 3.69), (8, 31, 3.71), (2048, 10, 24.87), (64, 6, 4.75), (16, 4, 3.96)]
INFO 07-29 11:15:08 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 622, 3.76), (1, 267, 3.4), (4, 87, 3.69), (48, 71, 4.48), (40, 48, 4.5), (8, 31, 3.71), (56, 29, 4.52), (2048, 10, 24.87), (64, 9, 4.66), (16, 4, 3.96)]
INFO 07-29 11:15:09 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 622, 3.76), (1, 267, 3.4), (24, 102, 4.27), (4, 87, 3.69), (48, 71, 4.48), (40, 71, 4.5), (32, 37, 4.3), (8, 31, 3.71), (56, 29, 4.52), (2048, 10, 24.87), (64, 9, 4.66), (16, 4, 3.96)]
INFO 07-29 11:15:10 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 622, 3.76), (1, 267, 3.4), (16, 141, 4.1), (24, 131, 4.27), (4, 87, 3.69), (48, 71, 4.48), (40, 71, 4.5), (32, 37, 4.3), (8, 36, 3.72), (56, 29, 4.52), (2048, 10, 24.87), (64, 9, 4.66)]
INFO 07-29 11:15:11 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 622, 3.76), (1, 267, 3.4), (4, 183, 3.82), (16, 141, 4.1), (24, 131, 4.27), (8, 123, 3.96), (48, 71, 4.48), (40, 71, 4.5), (32, 37, 4.3), (56, 29, 4.52), (2048, 10, 24.87), (64, 9, 4.66)]

with number of prompts: 1000
INFO 07-29 11:17:17 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (48, 71, 4.48), (40, 71, 4.5), (2048, 39, 27.59), (32, 37, 4.3), (56, 29, 4.52), (64, 9, 4.66)]
INFO 07-29 11:17:18 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (48, 71, 4.48), (40, 71, 4.5), (2048, 48, 28.2), (32, 37, 4.3), (56, 29, 4.52), (64, 9, 4.66), (256, 4, 6.58), (551, 2, 14.69), (280, 2, 9.98)]
INFO 07-29 11:17:19 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (48, 71, 4.48), (40, 71, 4.5), (2048, 48, 28.2), (32, 37, 4.3), (56, 29, 4.52), (256, 28, 6.87), (64, 9, 4.66), (280, 4, 10.04), (296, 3, 10.43), (272, 3, 10.05), (264, 3, 10.62), (551, 2, 14.69), (304, 2, 10.72), (344, 2, 11.39)]
INFO 07-29 11:17:20 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (48, 71, 4.48), (40, 71, 4.5), (2048, 49, 28.32), (256, 43, 7.13), (32, 37, 4.3), (56, 29, 4.52), (64, 9, 4.66), (280, 7, 10.17), (264, 6, 10.75), (272, 5, 10.43), (296, 3, 10.43), (352, 3, 11.87), (344, 3, 11.62), (288, 3, 10.94), (551, 2, 14.69), (304, 2, 10.72), (1031, 2, 23.56), (1091, 2, 23.66), (424, 2, 12.97), (512, 2, 13.91)]
INFO 07-29 11:17:21 [loggers.py:118] Engine 000: Avg prompt throughput: 14844.6 tokens/s, Avg generation throughput: 5725.3 tokens/s, Running: 255 reqs, Waiting: 259 reqs, GPU KV cache usage: 5.0%, Prefix cache hit rate: 13.7%
INFO 07-29 11:17:21 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (48, 71, 4.48), (40, 71, 4.5), (256, 55, 7.29), (2048, 50, 28.43), (32, 37, 4.3), (56, 29, 4.52), (280, 11, 11.1), (64, 9, 4.66), (272, 7, 10.92), (264, 6, 10.75), (344, 4, 11.9), (288, 4, 11.0), (512, 4, 14.12), (304, 3, 10.97), (320, 3, 12.01), (296, 3, 10.43), (352, 3, 11.87), (472, 3, 13.66), (828, 2, 20.08), (416, 2, 13.08), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (1031, 2, 23.56), (1091, 2, 23.66), (312, 2, 11.71), (424, 2, 12.97)]
INFO 07-29 11:17:23 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (48, 71, 4.48), (40, 71, 4.5), (256, 70, 7.52), (2048, 51, 28.53), (32, 37, 4.3), (56, 29, 4.52), (280, 13, 11.13), (272, 11, 11.38), (64, 9, 4.66), (264, 9, 11.19), (288, 6, 11.22), (512, 5, 14.25), (344, 4, 11.9), (416, 3, 13.63), (304, 3, 10.97), (320, 3, 12.01), (296, 3, 10.43), (352, 3, 11.87), (472, 3, 13.66), (828, 2, 20.08), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (1031, 2, 23.56), (958, 2, 21.04), (1091, 2, 23.66), (312, 2, 11.71), (424, 2, 12.97), (336, 2, 12.64)]
INFO 07-29 11:17:24 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (256, 76, 7.61), (48, 71, 4.48), (40, 71, 4.5), (2048, 52, 28.56), (32, 37, 4.3), (56, 29, 4.52), (280, 14, 11.26), (272, 13, 11.62), (64, 9, 4.66), (264, 9, 11.19), (288, 6, 11.22), (512, 5, 14.25), (304, 4, 11.46), (296, 4, 10.71), (344, 4, 11.9), (416, 3, 13.63), (320, 3, 12.01), (352, 3, 11.87), (472, 3, 13.66), (312, 3, 11.97), (336, 3, 13.0), (828, 2, 20.08), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (1031, 2, 23.56), (958, 2, 21.04), (1091, 2, 23.66), (628, 2, 17.18), (424, 2, 12.97), (1024, 2, 23.36)]
INFO 07-29 11:17:25 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (256, 84, 7.83), (48, 71, 4.48), (40, 71, 4.5), (2048, 54, 28.6), (32, 37, 4.3), (56, 29, 4.52), (280, 15, 11.39), (272, 14, 11.83), (64, 9, 4.66), (264, 9, 11.19), (288, 7, 11.4), (304, 5, 11.96), (512, 5, 14.25), (416, 4, 13.92), (296, 4, 10.71), (344, 4, 11.9), (312, 4, 12.92), (320, 3, 12.01), (352, 3, 11.87), (472, 3, 13.66), (1031, 3, 23.8), (336, 3, 13.0), (828, 2, 20.08), (653, 2, 17.26), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (958, 2, 21.04), (432, 2, 14.27), (1091, 2, 23.66), (628, 2, 17.18), (424, 2, 12.97), (783, 2, 20.54), (1024, 2, 23.36), (514, 2, 17.95), (1016, 2, 23.78), (1035, 2, 26.47)]
INFO 07-29 11:17:26 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (256, 85, 7.84), (48, 71, 4.48), (40, 71, 4.5), (2048, 55, 28.61), (32, 37, 4.3), (56, 29, 4.52), (280, 16, 11.41), (272, 15, 12.03), (232, 10, 8.39), (240, 10, 8.48), (64, 9, 4.66), (264, 9, 11.19), (288, 7, 11.4), (208, 7, 8.07), (224, 6, 8.28), (200, 6, 8.0), (304, 5, 11.96), (312, 5, 13.24), (512, 5, 14.25), (216, 5, 8.11), (416, 4, 13.92), (296, 4, 10.71), (344, 4, 11.9), (248, 4, 8.59), (320, 3, 12.01), (352, 3, 11.87), (472, 3, 13.66), (1031, 3, 23.8), (336, 3, 13.0), (828, 2, 20.08), (653, 2, 17.26), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (958, 2, 21.04), (432, 2, 14.27), (1091, 2, 23.66), (628, 2, 17.18), (424, 2, 12.97), (783, 2, 20.54), (1024, 2, 23.36), (582, 2, 18.8), (514, 2, 17.95), (1016, 2, 23.78), (1035, 2, 26.47), (360, 2, 14.79)]
INFO 07-29 11:17:27 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (256, 85, 7.84), (48, 71, 4.48), (40, 71, 4.5), (2048, 55, 28.61), (32, 37, 4.3), (56, 29, 4.52), (168, 24, 7.69), (280, 16, 11.41), (272, 15, 12.03), (136, 12, 7.26), (200, 12, 7.95), (144, 11, 7.47), (160, 10, 7.59), (232, 10, 8.39), (192, 10, 7.8), (240, 10, 8.48), (64, 9, 4.66), (264, 9, 11.19), (288, 7, 11.4), (208, 7, 8.07), (176, 7, 7.74), (224, 6, 8.28), (152, 5, 7.62), (304, 5, 11.96), (312, 5, 13.24), (512, 5, 14.25), (216, 5, 8.11), (416, 4, 13.92), (296, 4, 10.71), (344, 4, 11.9), (248, 4, 8.59), (184, 4, 7.77), (128, 4, 6.99), (320, 3, 12.01), (352, 3, 11.87), (472, 3, 13.66), (1031, 3, 23.8), (336, 3, 13.0), (828, 2, 20.08), (653, 2, 17.26), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (958, 2, 21.04), (432, 2, 14.27), (1091, 2, 23.66), (628, 2, 17.18), (424, 2, 12.97), (783, 2, 20.54), (1024, 2, 23.36), (582, 2, 18.8), (514, 2, 17.95), (1016, 2, 23.78), (1035, 2, 26.47), (360, 2, 14.79)]
INFO 07-29 11:17:28 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (256, 85, 7.84), (48, 71, 4.48), (40, 71, 4.5), (2048, 55, 28.61), (32, 37, 4.3), (56, 29, 4.52), (80, 26, 6.17), (112, 25, 6.72), (168, 24, 7.69), (104, 21, 6.64), (280, 16, 11.41), (272, 15, 12.03), (136, 12, 7.26), (200, 12, 7.95), (144, 11, 7.47), (120, 11, 6.79), (88, 11, 6.27), (160, 10, 7.59), (232, 10, 8.39), (192, 10, 7.8), (240, 10, 8.48), (128, 10, 6.98), (64, 9, 4.66), (264, 9, 11.19), (96, 9, 6.43), (288, 7, 11.4), (208, 7, 8.07), (176, 7, 7.74), (224, 6, 8.28), (152, 5, 7.62), (304, 5, 11.96), (312, 5, 13.24), (512, 5, 14.25), (216, 5, 8.11), (416, 4, 13.92), (296, 4, 10.71), (344, 4, 11.9), (248, 4, 8.59), (184, 4, 7.77), (320, 3, 12.01), (352, 3, 11.87), (472, 3, 13.66), (1031, 3, 23.8), (336, 3, 13.0), (828, 2, 20.08), (653, 2, 17.26), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (958, 2, 21.04), (432, 2, 14.27), (1091, 2, 23.66), (628, 2, 17.18), (424, 2, 12.97), (783, 2, 20.54), (1024, 2, 23.36), (582, 2, 18.8), (514, 2, 17.95), (1016, 2, 23.78), (1035, 2, 26.47), (360, 2, 14.79)]
INFO 07-29 11:17:29 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 143, 4.1), (24, 131, 4.27), (8, 123, 3.96), (48, 111, 4.51), (40, 88, 4.5), (256, 85, 7.84), (56, 62, 5.61), (2048, 55, 28.61), (32, 37, 4.3), (64, 33, 5.78), (80, 26, 6.17), (112, 25, 6.72), (168, 24, 7.69), (104, 21, 6.64), (280, 16, 11.41), (272, 15, 12.03), (72, 13, 6.03), (136, 12, 7.26), (200, 12, 7.95), (144, 11, 7.47), (120, 11, 6.79), (88, 11, 6.27), (160, 10, 7.59), (232, 10, 8.39), (192, 10, 7.8), (240, 10, 8.48), (128, 10, 6.98), (264, 9, 11.19), (96, 9, 6.43), (288, 7, 11.4), (208, 7, 8.07), (176, 7, 7.74), (224, 6, 8.28), (152, 5, 7.62), (304, 5, 11.96), (312, 5, 13.24), (512, 5, 14.25), (216, 5, 8.11), (416, 4, 13.92), (296, 4, 10.71), (344, 4, 11.9), (248, 4, 8.59), (184, 4, 7.77), (320, 3, 12.01), (352, 3, 11.87), (472, 3, 13.66), (1031, 3, 23.8), (336, 3, 13.0), (828, 2, 20.08), (653, 2, 17.26), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (958, 2, 21.04), (432, 2, 14.27), (1091, 2, 23.66), (628, 2, 17.18), (424, 2, 12.97), (783, 2, 20.54), (1024, 2, 23.36), (582, 2, 18.8), (514, 2, 17.95), (1016, 2, 23.78), (1035, 2, 26.47), (360, 2, 14.79)]
INFO 07-29 11:17:30 [forward_context.py:181] Batchsize forward time stats (batchsize, count, median_time(ms)): [(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 227, 4.16), (24, 155, 4.27), (8, 123, 3.96), (40, 114, 4.52), (48, 111, 4.51), (256, 85, 7.84), (56, 62, 5.61), (32, 59, 4.32), (2048, 55, 28.61), (64, 33, 5.78), (80, 26, 6.17), (112, 25, 6.72), (168, 24, 7.69), (104, 21, 6.64), (280, 16, 11.41), (272, 15, 12.03), (72, 13, 6.03), (136, 12, 7.26), (200, 12, 7.95), (144, 11, 7.47), (120, 11, 6.79), (88, 11, 6.27), (160, 10, 7.59), (232, 10, 8.39), (192, 10, 7.8), (240, 10, 8.48), (128, 10, 6.98), (264, 9, 11.19), (96, 9, 6.43), (288, 7, 11.4), (208, 7, 8.07), (176, 7, 7.74), (224, 6, 8.28), (152, 5, 7.62), (304, 5, 11.96), (312, 5, 13.24), (512, 5, 14.25), (216, 5, 8.11), (416, 4, 13.92), (296, 4, 10.71), (344, 4, 11.9), (248, 4, 8.59), (184, 4, 7.77), (320, 3, 12.01), (352, 3, 11.87), (472, 3, 13.66), (1031, 3, 23.8), (336, 3, 13.0), (828, 2, 20.08), (653, 2, 17.26), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (958, 2, 21.04), (432, 2, 14.27), (1091, 2, 23.66), (628, 2, 17.18), (424, 2, 12.97), (783, 2, 20.54), (1024, 2, 23.36), (582, 2, 18.8), (514, 2, 17.95), (1016, 2, 23.78), (1035, 2, 26.47), (360, 2, 14.79)]

POST-PROCESSING:
Once we have all the counts like for example:
[(2, 651, 3.76), (1, 393, 3.4), (4, 239, 3.83), (16, 227, 4.16), (24, 155, 4.27), (8, 123, 3.96), (40, 114, 4.52), (48, 111, 4.51), (256, 85, 7.84), (56, 62, 5.61), (32, 59, 4.32), (2048, 55, 28.61), (64, 33, 5.78), (80, 26, 6.17), (112, 25, 6.72), (168, 24, 7.69), (104, 21, 6.64), (280, 16, 11.41), (272, 15, 12.03), (72, 13, 6.03), (136, 12, 7.26), (200, 12, 7.95), (144, 11, 7.47), (120, 11, 6.79), (88, 11, 6.27), (160, 10, 7.59), (232, 10, 8.39), (192, 10, 7.8), (240, 10, 8.48), (128, 10, 6.98), (264, 9, 11.19), (96, 9, 6.43), (288, 7, 11.4), (208, 7, 8.07), (176, 7, 7.74), (224, 6, 8.28), (152, 5, 7.62), (304, 5, 11.96), (312, 5, 13.24), (512, 5, 14.25), (216, 5, 8.11), (416, 4, 13.92), (296, 4, 10.71), (344, 4, 11.9), (248, 4, 8.59), (184, 4, 7.77), (320, 3, 12.01), (352, 3, 11.87), (472, 3, 13.66), (1031, 3, 23.8), (336, 3, 13.0), (828, 2, 20.08), (653, 2, 17.26), (551, 2, 14.69), (480, 2, 13.48), (806, 2, 19.56), (958, 2, 21.04), (432, 2, 14.27), (1091, 2, 23.66), (628, 2, 17.18), (424, 2, 12.97), (783, 2, 20.54), (1024, 2, 23.36), (582, 2, 18.8), (514, 2, 17.95), (1016, 2, 23.78), (1035, 2, 26.47), (360, 2, 14.79)]

we can copy-paste in a text file (for example todelete.txt) and use the linux command:

>> cat todelete.txt | sed 's/), (/\n/g; s/[()]//g' > better1

Then we can use `hist-counts_batchsize` to get the multi-bar histograms.
